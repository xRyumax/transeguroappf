import type { Document } from './bson';
<<<<<<< HEAD
import { BSONValue } from './bson_value';
import { type InspectFn, defaultInspect } from './parser/utils';

/** @public */
export interface CodeExtended {
  $code: string;
=======

/** @public */
export interface CodeExtended {
  $code: string | Function;
>>>>>>> 36e6c1d122dc190a65359e5ccef36f21fa6dd909
  $scope?: Document;
}

/**
 * A class representation of the BSON Code type.
 * @public
 * @category BSONType
 */
<<<<<<< HEAD
export class Code extends BSONValue {
  get _bsontype(): 'Code' {
    return 'Code';
  }

  code: string;

  // a code instance having a null scope is what determines whether
  // it is BSONType 0x0D (just code) / 0x0F (code with scope)
  scope: Document | null;

=======
export class Code {
  _bsontype!: 'Code';

  code!: string | Function;
  scope?: Document;
>>>>>>> 36e6c1d122dc190a65359e5ccef36f21fa6dd909
  /**
   * @param code - a string or function.
   * @param scope - an optional scope for the function.
   */
<<<<<<< HEAD
  constructor(code: string | Function, scope?: Document | null) {
    super();
    this.code = code.toString();
    this.scope = scope ?? null;
  }

  toJSON(): { code: string; scope?: Document } {
    if (this.scope != null) {
      return { code: this.code, scope: this.scope };
    }

    return { code: this.code };
=======
  constructor(code: string | Function, scope?: Document) {
    if (!(this instanceof Code)) return new Code(code, scope);

    this.code = code;
    this.scope = scope;
  }

  toJSON(): { code: string | Function; scope?: Document } {
    return { code: this.code, scope: this.scope };
>>>>>>> 36e6c1d122dc190a65359e5ccef36f21fa6dd909
  }

  /** @internal */
  toExtendedJSON(): CodeExtended {
    if (this.scope) {
      return { $code: this.code, $scope: this.scope };
    }

    return { $code: this.code };
  }

  /** @internal */
  static fromExtendedJSON(doc: CodeExtended): Code {
    return new Code(doc.$code, doc.$scope);
  }

<<<<<<< HEAD
  inspect(depth?: number, options?: unknown, inspect?: InspectFn): string {
    inspect ??= defaultInspect;
    let parametersString = inspect(this.code, options);
    const multiLineFn = parametersString.includes('\n');
    if (this.scope != null) {
      parametersString += `,${multiLineFn ? '\n' : ' '}${inspect(this.scope, options)}`;
    }
    const endingNewline = multiLineFn && this.scope === null;
    return `new Code(${multiLineFn ? '\n' : ''}${parametersString}${endingNewline ? '\n' : ''})`;
  }
}
=======
  /** @internal */
  [Symbol.for('nodejs.util.inspect.custom')](): string {
    return this.inspect();
  }

  inspect(): string {
    const codeJson = this.toJSON();
    return `new Code("${String(codeJson.code)}"${
      codeJson.scope ? `, ${JSON.stringify(codeJson.scope)}` : ''
    })`;
  }
}

Object.defineProperty(Code.prototype, '_bsontype', { value: 'Code' });
>>>>>>> 36e6c1d122dc190a65359e5ccef36f21fa6dd909
